<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>도서 상세</title>

    <style>
        body {
            font-family: system-ui, sans-serif;
            max-width: 800px;
            margin: 40px auto;
        }

        .layout {
            display: flex;
            gap: 16px;
        }

        .cover {
            width: 400px;
        }

        .cover img {
            width: 100%;
            object-fit: cover;
        }

        .info h1 {
            margin: 0 0 8px;
            font-size: 1.5rem;
        }

        .meta {
            color: #555;
            margin-bottom: 8px;
        }

        .pages {
            color: #555;
            margin-bottom: 8px;
        }

        .desc {
            margin-bottom: 16px;
            white-space: pre-line;
        }

        section {
            margin-top: 24px;
        }

        section h2 {
            font-size: 1.1rem;
            margin-bottom: 8px;
        }

        input[type="number"], textarea {
            width: 100%;
            padding: 6px;
            box-sizing: border-box;
        }

        button {
            padding: 6px 10px;
            margin-top: 4px;
            cursor: pointer;
        }

        a {
            display: block;
            margin-bottom: 20px;
        }

        /* ===== 페이지 코멘트 모달 ===== */
        .modal.hidden {
            display: none;
        }

        .modal {
            position: fixed;
            inset: 0;
            z-index: 9999;
        }

        .modal-backdrop {
            position: absolute;
            inset: 0;
            background: rgba(0, 0, 0, 0.45);
        }

        .modal-content {
            position: relative;
            max-width: 650px;
            margin: 60px auto;
            background: #fff;
            border-radius: 8px;
            padding: 16px 20px 20px;
            box-shadow: 0 12px 30px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .modal-header h2 {
            margin: 0;
            font-size: 1.2rem;
        }

        .close-btn {
            border: none;
            background: transparent;
            font-size: 18px;
            cursor: pointer;
        }

        .modal-body {
            font-size: 0.95rem;
        }

        .comment-list {
            list-style: none;
            padding: 0;
            margin: 8px 0 0;
            border: 1px solid #eee;
            border-radius: 4px;
            max-height: 260px;
            overflow-y: auto;
        }

        .comment-list-empty {
            padding: 8px;
            color: #666;
            font-size: 0.9rem;
        }

        .comment-item {
            border-bottom: 1px solid #eee;
            padding: 6px 8px;
            font-size: 0.9rem;
        }

        .comment-item:last-child {
            border-bottom: none;
        }

        .comment-meta {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 2px;
        }

        /* ===== 리뷰 리스트 ===== */
        .review-item {
            border: 1px solid #eee;
            border-radius: 4px;
            padding: 8px;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }

        .review-meta {
            font-size: 0.8rem;
            color: #777;
            margin-bottom: 4px;
        }

        .review-body {
            white-space: pre-line;
        }
    </style>
</head>
<body>

<a th:href="@{/}">← 검색으로 돌아가기</a>

<div class="layout">
    <div class="cover">
        <img alt="cover" id="cover" src="">
    </div>
    <div class="info">
        <h1 id="title">제목</h1>
        <div class="meta" id="meta"></div>
        <div class="pages" id="pages"></div>
        <div class="desc" id="desc"></div>
    </div>
</div>

<section>
    <h2>진행도</h2>
    <div>
        현재 페이지: <span id="currentPage">0</span>p
        <span id="progressPercent">(0%)</span>
    </div>
    <div style="margin-top:6px;">
        <input id="progressInput" min="0" placeholder="현재 읽은 페이지" type="number">
        <button id="progressBtn">저장</button>
    </div>
</section>

<section>
    <h2>페이지 코멘트</h2>

    <button id="openCommentModalBtn">페이지 코멘트 창 열기</button>

    <div style="margin-top:10px;">
        <input id="quickCommentPage" min="1" placeholder="코멘트를 남길 페이지 번호"
               type="number">
    </div>
    <div style="margin-top:4px;">
        <textarea id="quickCommentText" placeholder="이 페이지에 대한 코멘트를 바로 작성해 저장할 수 있습니다."
                  rows="3"></textarea>
        <button id="quickCommentBtn" type="button">코멘트 추가</button>
    </div>
</section>

<section>
    <h2>
        총평 (리뷰)
        <span id="reviewAverage"
              style="font-size:0.9rem; color:#555; margin-left:8px;"></span>
    </h2>

    <div id="reviewList"></div>

    <div id="reviewForm">
        <textarea id="reviewText" placeholder="한줄평을 입력하세요"></textarea>

        <div>
            <label for="reviewRating">평점 (1~5):</label>
            <input id="reviewRating"
                   max="5"
                   min="1"
                   placeholder="예: 4.5"
                   step="0.1"
                   type="number">
        </div>

        <label>
            <input id="reviewSpoiler" type="checkbox">
            스포일러 포함
        </label>

        <button onclick="saveReview()" type="button">리뷰 저장</button>
    </div>
</section>

<!-- 모달 -->
<div class="modal hidden" id="commentModal">
    <div class="modal-backdrop"></div>
    <div class="modal-content">
        <div class="modal-header">
            <h2>페이지 코멘트</h2>
            <button class="close-btn" id="closeCommentModalBtn" type="button">✕</button>
        </div>
        <div class="modal-body">

            <div style="margin-bottom:10px;">
                <label>
                    페이지:
                    <input id="modalCommentPage" min="1" style="width:80px;" type="number">
                </label>
            </div>
            <div style="margin-bottom:10px;">
                <textarea id="modalCommentText" placeholder="이 페이지에 대한 코멘트를 작성하세요" rows="3"></textarea>
                <button id="modalAddCommentBtn" type="button">코멘트 추가</button>
            </div>

            <div style="margin-bottom:10px; padding:8px; border:1px solid #eee; border-radius:4px; font-size:0.9rem;">
                <div style="margin-bottom:6px; font-weight:600;">표시 옵션</div>

                <!-- 현재 서버에서 가져온 범위 표시 -->
                <div id="currentFilterInfo" style="margin-bottom:6px; color:#555;"></div>

                <div style="display:flex; flex-wrap:wrap; gap:8px; align-items:center;">
                    <span>페이지 범위:</span>
                    <input id="filterFrom" min="1" placeholder="from" style="width:80px;" type="number">
                    <span>~</span>
                    <input id="filterTo" min="1" placeholder="to" style="width:80px;" type="number">

                    <span style="margin-left:12px;">정렬:</span>
                    <select id="sortOrder">
                        <option value="asc">페이지 오름차순</option>
                        <option value="desc">페이지 내림차순</option>
                    </select>

                    <button id="applyFilterBtn" type="button">적용</button>
                    <button id="resetFilterBtn" type="button">초기화</button>
                </div>
            </div>

            <div id="modalPageInfo" style="font-size:0.9rem; color:#555; margin-bottom:6px;"></div>
            <ul class="comment-list" id="modalCommentList"></ul>
        </div>
    </div>
</div>

<input id="isbn13Hidden" th:value="${isbn13}" type="hidden"/>

<script src="/js/book-detail.js"></script>

</body>
</html>
