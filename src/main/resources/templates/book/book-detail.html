<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>도서 상세</title>
    <link rel="stylesheet" th:href="@{/css/book-detail.css}">
</head>
<body>

<header class="topbar">
    <div class="topbar-inner">
        <a class="back-link" th:href="@{/}">
            <span class="arrow">←</span>
            <span>검색</span>
        </a>

        <!-- 로그인 상태: nickname 존재 -->
        <div class="user-area" th:if="${nickname != null}">
            <span class="nickname" th:text="'(' + ${nickname} + ')'">(닉네임)</span>
            <span class="sep">|</span>
            <a th:href="@{/logout}">로그아웃</a>
        </div>

        <!-- 비로그인 상태 -->
        <div class="user-area" th:if="${nickname == null}">
            <a th:href="@{/login}">로그인</a>
            <span class="sep">|</span>
            <a th:href="@{/signup}">회원가입</a>
        </div>
    </div>
</header>

<div class="page">
    <div class="layout">
        <div class="cover">
            <img alt="cover" id="cover" src="">
        </div>

        <div class="info">
            <h1 id="title">제목</h1>
            <div class="meta" id="meta"></div>
            <div class="pages" id="pages"></div>
            <div class="desc" id="desc"></div>
        </div>
    </div>

    <section>
        <h2>진행도</h2>
        <div class="progress-line">
            현재 페이지: <span id="currentPage">0</span>p
            <span id="progressPercent">(0%)</span>
        </div>

        <div class="field-row">
            <input id="progressInput" min="0" placeholder="현재 읽은 페이지" type="number">
            <button id="progressBtn" type="button">저장</button>
        </div>
    </section>

    <section>
        <h2>페이지 코멘트</h2>

        <button id="openCommentModalBtn" type="button">페이지 코멘트 창 열기</button>

        <div class="field-row" style="margin-top:10px;">
            <input id="quickCommentPage" min="1" placeholder="코멘트를 남길 페이지 번호" type="number">
        </div>

        <div class="field-row">
            <textarea id="quickCommentText" placeholder="이 페이지에 대한 코멘트를 바로 작성해 저장할 수 있습니다." rows="3"></textarea>
        </div>
        <button id="quickCommentBtn" type="button">코멘트 추가</button>
    </section>

    <section>
        <h2>
            총평 (리뷰)
            <span id="reviewAverage" style="font-size:13px; color:#666; margin-left:8px;"></span>
        </h2>

        <div id="reviewList"></div>

        <div id="reviewForm">
            <textarea id="reviewText" placeholder="한줄평을 입력하세요" rows="4"></textarea>

            <div class="field-row">
                <input id="reviewRating" max="5" min="1" step="0.1" type="number" placeholder="평점 (예: 4.5)">
            </div>

            <label style="display:inline-flex; align-items:center; gap:8px; margin-top:8px; font-size:14px;">
                <input id="reviewSpoiler" type="checkbox">
                스포일러 포함
            </label>

            <div style="margin-top:10px;">
                <button onclick="saveReview()" type="button">리뷰 저장</button>
            </div>
        </div>
    </section>
</div>

<!-- 모달 -->
<div class="modal hidden" id="commentModal">
    <div class="modal-backdrop"></div>

    <div class="modal-content">
        <div class="modal-header">
            <h2>페이지 코멘트</h2>
            <button class="close-btn" id="closeCommentModalBtn" type="button">✕</button>
        </div>

        <div class="modal-body">

            <!-- 상단 2열 -->
            <div class="modal-top-grid">
                <!-- 왼쪽: 코멘트 추가 -->
                <div class="panel">
                    <div class="panel-title">코멘트 추가</div>

                    <div class="row" style="margin-bottom:10px;">
                        <span style="color:#666;">페이지:</span>
                        <input id="modalCommentPage" min="1" class="mini" type="number">
                    </div>

                    <textarea id="modalCommentText" placeholder="이 페이지에 대한 코멘트를 작성하세요" rows="4"></textarea>

                    <div style="margin-top:8px;">
                        <button id="modalAddCommentBtn" type="button">코멘트 추가</button>
                    </div>
                </div>

                <!-- 오른쪽: 표시 옵션 -->
                <div class="panel">
                    <div class="panel-title">표시 옵션</div>
                    <div id="currentFilterInfo" style="margin-bottom:8px; color:#666; font-size:13px;"></div>

                    <div class="row">
                        <span style="color:#666;">범위</span>
                        <input id="filterFrom" min="1" placeholder="from" class="mini" type="number">
                        <span style="color:#666;">~</span>
                        <input id="filterTo" min="1" placeholder="to" class="mini" type="number">
                    </div>

                    <div class="row" style="margin-top:8px;">
                        <span style="color:#666;">정렬</span>
                        <select id="sortOrder">
                            <option value="asc">페이지 오름차순</option>
                            <option value="desc">페이지 내림차순</option>
                        </select>
                    </div>

                    <div class="row" style="margin-top:10px;">
                        <button id="applyFilterBtn" type="button">적용</button>
                        <button id="resetFilterBtn" type="button">초기화</button>
                    </div>
                </div>
            </div>

            <!-- 아래: 리스트 영역(남은 공간 전부) -->
            <div class="modal-list-area">
                <div id="modalPageInfo" style="font-size:13px; color:#666; margin:6px 0 6px;"></div>
                <ul class="comment-list" id="modalCommentList"></ul>
            </div>

        </div>

    </div>
</div>

<input id="isbn13Hidden" th:value="${isbn13}" type="hidden"/>

<script th:src="@{/js/book-detail.js}"></script>
</body>
</html>
